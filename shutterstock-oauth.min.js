var ShutterstockOAuth=function(){window.location.origin||(window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""));var a={};a.isNull=function(a){return null===a||void 0===a},a.isPresent=function(b){return!a.isNull(b)&&""!==b},a.fallback=function(b,c){return a.isPresent(b)?b:c},a.ensure=function(b,c){if(a.isPresent(b))return b;throw new Error("Missing value. "+c)},a.pathJoin=function(b,c){return a.ensure(b,"parentPath"),a.ensure(c,"childPath"),b=b.replace(/\/$/,""),c=c.replace(/^\//,""),b+"/"+c},a.isSameDomain=function(b){try{return a.isPresent(b.document.URL)&&"about:blank"!==b.document.URL&&b.document.domain===document.domain}catch(c){return!1}},a.getUrlVars=function(b){a.ensure(b,"url");var c,d={};if(b.indexOf("?")<1)return{};for(var e=b.slice(b.indexOf("?")+1).split("&"),f=0;f<e.length;f++)c=e[f].split("="),d[c[0]]=decodeURIComponent(c[1]);return d},a.buildUrl=function(b,c){var d="",e="";for(var f in c)a.isPresent(c[f])&&(d+=e+f+"="+encodeURI(c[f]),e="&");return b+"?"+d},a.randomString=function(){return Math.random().toString(36).slice(2)},a.clone=function(a){var b={};for(var c in a)b[c]=a[c];return b},a.endpointForRealm=function(a){return"offset"===a?"https://accounts.offset.com/oauth/authorize":"contributor"===a?"https://contributor-accounts.shutterstock.com/oauth/authorize":"https://accounts.shutterstock.com/oauth/authorize"};var b=function(b){b||(b={});var c=this;c.QUERY_PARAMS=["redirect_uri","client_id","response_type","type","state","scope"],c.params={client_id:a.ensure(b.client_id,"client_id"),scope:a.ensure(b.scope,"scope"),redirect_uri:a.pathJoin(window.location.origin,a.ensure(b.redirect_endpoint,"redirect_endpoint")),type:a.fallback(b.request_type,"web_server"),state:a.fallback(b.state,a.randomString()),response_type:a.fallback(b.response_type,"code"),site:b.site,display:"popup"},c.realm=a.fallback(b.realm,"customer"),c.endpoint=a.fallback(b.endpoint,a.endpointForRealm(c.realm));var d=a.buildUrl(c.endpoint,c.params);c.success=b.success,c.failure=b.failure,c.complete=b.complete,c.authorize=function(){a.ensure(d,"oauthUrl"),c.popup=window.open(d,"_blank",i()),e()};var e=function(){c.isMonitoring||f()},f=function(){c.isMonitoring=!0,c.popup?c.popup.closed?(c.isMonitoring=!1,g("popup:closed")):a.isSameDomain(c.popup)?(c.isMonitoring=!1,g("completed",c.popup.document.URL),c.popup.close()):setTimeout(f,250,c):(c.isMonitoring=!1,g("not_supported"))},g=function(b,d){var e={};a.isPresent(d)&&(e=a.getUrlVars(d)),"not_supported"===b&&(e=a.clone(j)),"popup:closed"===b&&(e=a.clone(k)),a.isPresent(e.state)&&(e.state!==c.params.state&&(e=a.clone(l)),delete e.state),h(e)},h=function(b){a.isPresent(b.error)?c.failure&&c.failure(b):c.success&&c.success(b),c.complete&&c.complete(b)},i=function(){var a=500,b=500,c=screen.width/2-a/2,d=.5*(screen.height/2-b/2);return"width="+a+", height="+b+", top="+d+", left="+c},j={error:"not_supported",error_description:"This browser does not support this feature.",error_reason:"not_supported"},k={error:"access_denied",error_description:"The popup was closed before authorization was completed.",error_reason:"user_denied"},l={error:"access_denied",error_description:"The response state did not match the request.",error_reason:"invalid_state"};return c};return b.util=a,b}();